#!/usr/bin/with-contenv bashio
# ==============================================================================
# Start the example service
# s6-overlay docs: https://github.com/just-containers/s6-overlay
# ==============================================================================

# Add your code here

# Declare variables
declare message

## Get the 'message' key from the user config options.
message=$(bashio::config 'message')
ess_ip=$(bashio::config 'ess_ip')
ess_password=$(bashio::config 'ess_password')
mqtt_host=$(bashio::services mqtt "host")
mqtt_user=$(bashio::services mqtt "username")
mqtt_password=$(bashio::services mqtt "password")


## Print the message the user supplied, defaults to "Hello World..."
bashio::log.info "${message:="Hello World..."}"

#  ess_ip: "127.0.0.1"
#  ess_password: "ess_password"
#  mqtt_ip: "127.0.0.1"
#  mqtt_port: "8888"
#  mqtt_user: "user"
#  mqtt_password: "password"

## Run your program
exec /usr/bin/pyess --ess_password ${ess_password} --mqtt_server ${mqtt_host} --mqtt_user=${mqtt_user} --mqtt_password=${mqtt_password} --interval_seconds=10 --ess_ip=${ess_ip}

exec echo "lala"