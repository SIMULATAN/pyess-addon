#!/usr/bin/with-contenv bashio
# ==============================================================================
# Start the example service
# s6-overlay docs: https://github.com/just-containers/s6-overlay
# ==============================================================================

# Add your code here

bashio::log.info "declaring variables"

# Declare variables
declare ess_ip sensors ess_password mqtt_host mqtt_user mqtt_password

## Get the 'message' key from the user config options.

bashio::log.info "reading config"

ess_ip=$(bashio::config 'ess_ip')
sensors=$(bashio::config 'ess_sensors')
ess_password=$(bashio::config 'ess_password')
mqtt_host=$(bashio::services mqtt "host")
mqtt_user=$(bashio::services mqtt "username")
mqtt_password=$(bashio::services mqtt "password")

bashio::log.info "done reading config"


## Print the message the user supplied, defaults to "Hello World..."
bashio::log.info "Starting pyss with ess ${ess_ip}"

#  ess_ip: "127.0.0.1"
#  ess_password: "ess_password"
#  mqtt_ip: "127.0.0.1"
#  mqtt_port: "8888"
#  mqtt_user: "user"
#  mqtt_password: "password"

ls -l /usr/bin/essmqtt
ls /usr/bin

## Run your program
/usr/bin/my_program
/usr/bin/essmqtt --ess_password ${ess_password} --mqtt_server ${mqtt_host} --mqtt_user=${mqtt_user} --mqtt_password=${mqtt_password} --interval_seconds=10 --ess_ip=${ess_ip} --hass_autoconfig_sensors=${sensors}
